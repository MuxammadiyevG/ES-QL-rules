rule_id: a1af5fd4-39e1-4a6c-9fc0-0986f5eeeb6f
name: "INFO - Linux Session Closed (USER_END/USER_LOGOUT) (auditd)"
description: |
  Baselines session closing via auditd USER_END/USER_LOGOUT (who logged out).
type: esql
params: '{}'
schedule_interval: 5m
index:
  - logs-updive.audit-*
query_language: esql
query: |
  FROM logs-updive.audit-*
  | WHERE event.dataset == "auditd"
  | WHERE COALESCE(event.original, "") RLIKE "(?i)type=(USER_END|USER_LOGOUT)"
  | STATS
      event_count = COUNT(*),
      users = VALUES(user.name),
      user_ids = VALUES(user.id),
      src_ips = VALUES(source.ip),
      pids = VALUES(process.pid),
      processes = VALUES(process.name),
      executables = VALUES(process.executable),
      raws = VALUES(event.original)
    BY agent_id, host.name, bucket = DATE_TRUNC(10 minutes, @timestamp)
  | KEEP agent_id, bucket, host.name, event_count, users, user_ids, src_ips, pids, processes, executables, raws
  | SORT event_count DESC
enabled: false
tags: ["informational", "linux", "session", "auditd", "ssh"]
severity: informational
risk_score: 1
nist: ["AU-12"]
pci_dss: ["10.2"]
gdpr: ["32.1.a"]
mitre_attack: {}